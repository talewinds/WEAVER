<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wish Weaver - Digital Card Creator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Oswald:wght@400;700&family=Caveat:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Define custom fonts for easy switching */
        .font-inter { font-family: 'Inter', sans-serif; }
        .font-oswald { font-family: 'Oswald', sans-serif; }
        .font-caveat { font-family: 'Caveat', cursive; }
        .font-mono { font-family: 'Roboto Mono', monospace; }

        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f0f4f8; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* Styles for the draggable text overlays */
        .draggable-text {
            position: absolute;
            cursor: grab;
            user-select: none;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); /* Enhance visibility */
            padding: 4px 8px;
            border: 2px dashed rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%); /* Center the element on its defined position */
            transition: opacity 0.3s;
            max-width: 90%;
            overflow-wrap: break-word;
        }

        .draggable-text:active {
            cursor: grabbing;
        }
        
        /* AdSense Simulation Styles */
        .adsense-placeholder {
            min-height: 90px;
            border: 2px dashed #34d399;
            background-color: #e0fcf4;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #065f46;
            font-weight: bold;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 20px;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#1e40af',
                        'secondary-green': '#059669',
                        'accent-yellow': '#facc15',
                        'background-light': '#f8fafc',
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-background-light font-inter text-gray-800 antialiased min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-primary-blue shadow-lg">
        <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <h1 class="text-3xl font-bold text-white tracking-wider">
                <span class="text-accent-yellow">W</span>ish <span class="text-accent-yellow">W</span>eaver
            </h1>
            <button id="helpButton" class="bg-accent-yellow text-primary-blue font-semibold py-2 px-4 rounded-full transition duration-300 hover:bg-yellow-300 shadow-md">
                How to Use
            </button>
        </div>
    </header>

    <!-- Main Content Grid -->
    <main class="max-w-7xl mx-auto w-full flex-grow p-4 lg:p-8 grid lg:grid-cols-3 gap-8">
        
        <!-- Left Column: Controls and AdSense -->
        <section class="lg:col-span-1 space-y-6">

            <!-- AdSense Placeholder Top -->
            <div class="adsense-placeholder h-24">
                [ AdSense Ad - 300x250 or Leaderboard ]
            </div>

            <!-- Image Uploader -->
            <div class="bg-white p-6 rounded-xl shadow-2xl border border-gray-100">
                <h2 class="text-xl font-bold mb-4 text-primary-blue">1. Choose Your Canvas</h2>
                <input type="file" id="imageUpload" accept="image/*" class="w-full text-sm text-gray-700
                    file:mr-4 file:py-2 file:px-4
                    file:rounded-full file:border-0
                    file:text-sm file:font-semibold
                    file:bg-secondary-green file:text-white
                    hover:file:bg-emerald-600 transition duration-150
                "/>
            </div>

            <!-- Text Customization -->
            <div id="customizationPanel" class="bg-white p-6 rounded-xl shadow-2xl border border-gray-100 space-y-6">
                <h2 class="text-xl font-bold text-primary-blue">2. Customize Your Message</h2>
                
                <!-- Main Wish Statement -->
                <div>
                    <label for="wishText" class="block text-sm font-medium text-gray-700 mb-1">Main Wish Statement (e.g., Happy Birthday!)</label>
                    <input type="text" id="wishText" maxlength="100" placeholder="Enter your main wish here" class="w-full border-gray-300 rounded-lg shadow-sm focus:border-primary-blue focus:ring-primary-blue p-2" value="Happy Moments!" />
                    <div class="flex space-x-2 mt-2">
                        <input type="color" id="wishColor" value="#ffffff" title="Text Color" class="w-8 h-8 rounded-full border-2 border-gray-300 cursor-pointer">
                        <input type="number" id="wishSize" min="20" max="100" value="48" title="Font Size" class="w-16 border-gray-300 rounded-lg p-1 text-center text-sm">
                        <select id="wishFont" class="flex-grow border-gray-300 rounded-lg text-sm p-1">
                            <option value="font-oswald" class="font-oswald">Oswald (Bold)</option>
                            <option value="font-caveat" class="font-caveat">Caveat (Cursive)</option>
                            <option value="font-inter" class="font-inter">Inter (Modern)</option>
                            <option value="font-mono" class="font-mono">Roboto Mono (Typewriter)</option>
                        </select>
                    </div>
                </div>

                <!-- Sub-Text -->
                <div>
                    <label for="subText" class="block text-sm font-medium text-gray-700 mb-1">Sub-Text (Max 20 words)</label>
                    <textarea id="subText" maxlength="120" rows="2" placeholder="A small message (max 20 words)" class="w-full border-gray-300 rounded-lg shadow-sm focus:border-primary-blue focus:ring-primary-blue p-2">Wishing you a wonderful day filled with joy and laughter!</textarea>
                    <div class="flex space-x-2 mt-2">
                        <input type="color" id="subColor" value="#facc15" title="Text Color" class="w-8 h-8 rounded-full border-2 border-gray-300 cursor-pointer">
                        <input type="number" id="subSize" min="12" max="50" value="20" title="Font Size" class="w-16 border-gray-300 rounded-lg p-1 text-center text-sm">
                        <select id="subFont" class="flex-grow border-gray-300 rounded-lg text-sm p-1">
                            <option value="font-inter" class="font-inter">Inter (Modern)</option>
                            <option value="font-oswald" class="font-oswald">Oswald (Bold)</option>
                            <option value="font-caveat" class="font-caveat">Caveat (Cursive)</option>
                            <option value="font-mono" class="font-mono">Roboto Mono (Typewriter)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- AdSense Placeholder Bottom -->
            <div class="adsense-placeholder h-32">
                [ AdSense Ad - Large Rectangle ]
            </div>

        </section>

        <!-- Right Column: Card Preview and Output -->
        <section class="lg:col-span-2 space-y-6">
            <div class="bg-white p-4 sm:p-6 rounded-xl shadow-2xl border border-gray-100">
                <h2 class="text-xl font-bold mb-4 text-secondary-green">3. Live Preview & Positioning</h2>
                <div id="previewContainer" class="relative w-full aspect-square max-w-2xl mx-auto overflow-hidden rounded-lg shadow-inner bg-gray-200 border-4 border-primary-blue">
                    <canvas id="cardCanvas" class="w-full h-full"></canvas>
                    
                    <!-- Draggable HTML Overlays (Used for editing) -->
                    <div id="wishOverlay" class="draggable-text font-oswald text-white text-5xl" style="top: 25%; left: 50%;">Happy Moments!</div>
                    <div id="subOverlay" class="draggable-text font-inter text-accent-yellow text-xl" style="top: 80%; left: 50%;">Wishing you a wonderful day filled with joy and laughter!</div>
                    
                    <!-- Initial Placeholder for the image -->
                    <div id="imagePlaceholder" class="absolute inset-0 flex flex-col items-center justify-center text-gray-500 pointer-events-none">
                        <svg class="w-16 h-16 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                        <p class="text-lg font-semibold">Upload an image to start designing</p>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="mt-6 flex justify-center space-x-4">
                    <button id="processButton" class="flex-1 max-w-xs bg-secondary-green text-white font-bold py-3 px-6 rounded-full text-lg shadow-lg hover:bg-emerald-600 transition duration-300 transform hover:scale-105" disabled>
                        4. Generate Shareable Card
                    </button>
                </div>
                
                <!-- Share Output Area -->
                <div id="outputArea" class="mt-6 hidden bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <p class="text-center font-semibold text-lg text-primary-blue mb-3">Your Card is Ready!</p>
                    <div class="flex justify-center space-x-3 mb-4">
                        <a id="downloadLink" download="wishweaver-card.png" class="flex items-center space-x-2 bg-primary-blue text-white py-2 px-4 rounded-full hover:bg-blue-700 transition duration-150">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                            <span>Download PNG</span>
                        </a>
                    </div>
                    <p class="text-center text-sm text-gray-500">
                        Right-click (or long-press on mobile) the card below to save or share directly.
                    </p>
                    <img id="finalImagePreview" class="mt-4 w-full h-auto rounded-lg shadow-xl border border-gray-300 mx-auto max-w-sm" style="display: none;" alt="Final Generated Card">
                </div>
            </div>
        </section>
    </main>

    <!-- Footer Content (SEO and Privacy) -->
    <footer class="bg-gray-100 mt-8 py-8 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto grid md:grid-cols-3 gap-8 text-sm text-gray-600">
            
            <!-- Web App Write-up (SEO) -->
            <div>
                <h3 class="font-bold text-base text-primary-blue mb-2">About Wish Weaver</h3>
                <p>
                    Wish Weaver is the fastest, free digital card creator online. Effortlessly combine your favorite photos with personalized wish statements, invitation text, or festive greetings. Customize every detail, from font color and size to placement. Perfect for creating unique, shareable content for social mediaâ€”be it a birthday wish, a holiday card, or a simple invite. Create, download, and share your masterpiece instantly without any sign-up or data storage.
                </p>
            </div>

            <!-- Privacy Declaration -->
            <div>
                <h3 class="font-bold text-base text-primary-blue mb-2">Privacy Declaration</h3>
                <p>
                    **We value your privacy completely.** Wish Weaver operates entirely within your browser. **No images, text, or personal data are uploaded to our servers.** Your designs are processed locally, and the final card is generated directly for download. We do not require registration or store any usage data.
                </p>
                <div class="adsense-placeholder mt-4 h-16">
                    [ AdSense Ad - Text Link or Vertical Banner ]
                </div>
            </div>

            <!-- Features Summary -->
            <div>
                <h3 class="font-bold text-base text-primary-blue mb-2">Key Features</h3>
                <ul class="list-disc list-inside space-y-1">
                    <li>Single-file image upload (JPG, PNG, GIF).</li>
                    <li>Drag-and-drop text positioning on canvas.</li>
                    <li>Full customization of font, color, and size.</li>
                    <li>Automatic image fitting (crop-to-fit/center).</li>
                    <li>Instant, shareable PNG output.</li>
                    <li>100% privacy guarantee (no data stored).</li>
                </ul>
            </div>
        </div>
        <div class="text-center mt-8 text-xs text-gray-400">
            &copy; 2025 Wish Weaver. All rights reserved.
        </div>
    </footer>

    <script>
        const canvas = document.getElementById('cardCanvas');
        const ctx = canvas.getContext('2d');
        const imageUpload = document.getElementById('imageUpload');
        const previewContainer = document.getElementById('previewContainer');
        const imagePlaceholder = document.getElementById('imagePlaceholder');
        const processButton = document.getElementById('processButton');
        const outputArea = document.getElementById('outputArea');
        const downloadLink = document.getElementById('downloadLink');
        const finalImagePreview = document.getElementById('finalImagePreview');

        // Text Overlays (Draggable HTML elements)
        const wishOverlay = document.getElementById('wishOverlay');
        const subOverlay = document.getElementById('subOverlay');

        // Customization Inputs
        const inputs = {
            wishText: document.getElementById('wishText'),
            wishColor: document.getElementById('wishColor'),
            wishSize: document.getElementById('wishSize'),
            wishFont: document.getElementById('wishFont'),
            subText: document.getElementById('subText'),
            subColor: document.getElementById('subColor'),
            subSize: document.getElementById('subSize'),
            subFont: document.getElementById('subFont'),
        };

        // State Management
        let uploadedImage = new Image();
        let isImageLoaded = false;
        let activeOverlay = null; // Tracks which element is being dragged
        let offset = { x: 0, y: 0 }; // Mouse offset during drag

        // --- Core UI & Text Update Logic ---

        // 1. Resize Canvas & Overlays to fit container
        const resizeCanvas = () => {
            const size = previewContainer.clientWidth;
            canvas.width = size;
            canvas.height = size;
            if (isImageLoaded) {
                drawImageOnCanvas();
            } else {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        };

        // 2. Initial Setup and Listeners
        window.addEventListener('resize', resizeCanvas);
        window.addEventListener('load', () => {
            resizeCanvas(); // Set initial canvas size
            updateTextOverlays(); // Apply initial text styles
        });

        // 3. Update Text Overlays based on input values
        const updateTextOverlays = () => {
            // Main Wish
            wishOverlay.textContent = inputs.wishText.value;
            wishOverlay.style.color = inputs.wishColor.value;
            wishOverlay.style.fontSize = `${inputs.wishSize.value}px`;
            wishOverlay.className = `draggable-text ${inputs.wishFont.value}`;

            // Sub Text
            // Simple word count check for friendly feedback (max 20 words)
            const subWords = inputs.subText.value.trim().split(/\s+/).filter(Boolean);
            const truncatedSubText = subWords.length > 20 ? subWords.slice(0, 20).join(' ') : inputs.subText.value;
            inputs.subText.value = truncatedSubText; // Enforce max 20 words visually
            subOverlay.textContent = truncatedSubText;
            
            subOverlay.style.color = inputs.subColor.value;
            subOverlay.style.fontSize = `${inputs.subSize.value}px`;
            subOverlay.className = `draggable-text ${inputs.subFont.value}`;
        };

        // Attach listeners for all customization inputs
        Object.values(inputs).forEach(input => {
            input.addEventListener('input', updateTextOverlays);
        });

        // --- Image Loading and Drawing Logic ---

        // Draw image onto canvas, handling variable formats (Crop/Center)
        const drawImageOnCanvas = () => {
            if (!isImageLoaded) return;

            const canvasWidth = canvas.width;
            const canvasHeight = canvas.height;
            const imgWidth = uploadedImage.width;
            const imgHeight = uploadedImage.height;

            // Clear canvas
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);

            let scale = Math.max(canvasWidth / imgWidth, canvasHeight / imgHeight);
            let targetWidth = imgWidth * scale;
            let targetHeight = imgHeight * scale;
            let x = (canvasWidth - targetWidth) / 2;
            let y = (canvasHeight - targetHeight) / 2;

            // Draw the image cropped to fill the canvas
            ctx.drawImage(uploadedImage, x, y, targetWidth, targetHeight);
        };

        imageUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    uploadedImage.onload = () => {
                        isImageLoaded = true;
                        imagePlaceholder.style.display = 'none';
                        processButton.disabled = false;
                        outputArea.classList.add('hidden');
                        drawImageOnCanvas();
                    };
                    uploadedImage.onerror = () => {
                        console.error("Error loading image.");
                        isImageLoaded = false;
                    };
                    uploadedImage.src = event.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                isImageLoaded = false;
                imagePlaceholder.style.display = 'flex';
                processButton.disabled = true;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        });

        // --- Drag and Drop Logic (for HTML Overlays) ---

        const startDrag = (e) => {
            // Use e.touches[0] for touch events, e otherwise
            const clientX = e.clientX || e.touches[0].clientX;
            const clientY = e.clientY || e.touches[0].clientY;

            activeOverlay = e.currentTarget;
            activeOverlay.style.zIndex = 10;
            
            // Calculate mouse offset relative to the overlay's center
            const rect = activeOverlay.getBoundingClientRect();
            const parentRect = previewContainer.getBoundingClientRect();

            // Calculate current position relative to container (0-100%)
            const currentLeftPercent = parseFloat(activeOverlay.style.left) || 50;
            const currentTopPercent = parseFloat(activeOverlay.style.top) || 50;
            
            // Current center position in pixels
            const currentCenterX = parentRect.left + (parentRect.width * currentLeftPercent / 100);
            const currentCenterY = parentRect.top + (parentRect.height * currentTopPercent / 100);

            // Calculate offset between click position and element's center
            offset.x = clientX - currentCenterX;
            offset.y = clientY - currentCenterY;

            document.addEventListener('mousemove', drag, { passive: false });
            document.addEventListener('mouseup', stopDrag);
            document.addEventListener('touchmove', drag, { passive: false });
            document.addEventListener('touchend', stopDrag);
            e.preventDefault(); // Prevent default touch behavior (scrolling)
        };

        const drag = (e) => {
            if (!activeOverlay) return;

            const clientX = e.clientX || e.touches[0].clientX;
            const clientY = e.clientY || e.touches[0].clientY;

            const parentRect = previewContainer.getBoundingClientRect();
            
            // Calculate new center position (in pixels)
            const newCenterX = clientX - offset.x;
            const newCenterY = clientY - offset.y;

            // Convert pixel position back to percentage relative to the container
            let newLeftPercent = ((newCenterX - parentRect.left) / parentRect.width) * 100;
            let newTopPercent = ((newCenterY - parentRect.top) / parentRect.height) * 100;

            // Clamp values between 0% and 100% to keep text within the bounds
            newLeftPercent = Math.max(0, Math.min(100, newLeftPercent));
            newTopPercent = Math.max(0, Math.min(100, newTopPercent));

            activeOverlay.style.left = `${newLeftPercent}%`;
            activeOverlay.style.top = `${newTopPercent}%`;
            
            e.preventDefault(); // Prevent scrolling during drag
        };

        const stopDrag = () => {
            if (activeOverlay) {
                activeOverlay.style.zIndex = 1;
                activeOverlay = null;
            }
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
            document.removeEventListener('touchmove', drag);
            document.removeEventListener('touchend', stopDrag);
        };

        wishOverlay.addEventListener('mousedown', startDrag);
        wishOverlay.addEventListener('touchstart', startDrag);
        subOverlay.addEventListener('mousedown', startDrag);
        subOverlay.addEventListener('touchstart', startDrag);

        // --- Final Image Generation Logic ---

        const applyCanvasText = (textElement, text, maxCharPerLine) => {
            const fontName = textElement.className.match(/font-([a-z0-9]+)/i)[0].replace('font-', '');
            const fontSize = parseInt(textElement.style.fontSize) * (canvas.width / previewContainer.clientWidth);
            const color = textElement.style.color;
            const leftPercent = parseFloat(textElement.style.left);
            const topPercent = parseFloat(textElement.style.top);

            const x = (leftPercent / 100) * canvas.width;
            const y = (topPercent / 100) * canvas.height;

            // Setup context for text
            ctx.fillStyle = color;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // Custom font mapping for Canvas
            let canvasFontFamily;
            switch(fontName) {
                case 'oswald': canvasFontFamily = 'Oswald'; break;
                case 'caveat': canvasFontFamily = 'Caveat'; break;
                case 'mono': canvasFontFamily = 'Roboto Mono'; break;
                case 'inter':
                default: canvasFontFamily = 'Inter'; break;
            }
            ctx.font = `${fontSize}px ${canvasFontFamily}`;

            // Add text shadow for better contrast
            ctx.shadowColor = 'rgba(0, 0, 0, 0.7)';
            ctx.shadowBlur = 4;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;
            
            // Simple text wrapping (since sub-text has a word limit, it's simpler)
            const words = text.split(' ');
            let line = '';
            let lines = [];
            const lineHeight = fontSize * 1.2;

            for(let n = 0; n < words.length; n++) {
                let testLine = line + words[n] + ' ';
                let testWidth = ctx.measureText(testLine).width;
                if (testWidth > canvas.width * 0.8 && n > 0) { // Max 80% of canvas width
                    lines.push(line);
                    line = words[n] + ' ';
                } else {
                    line = testLine;
                }
            }
            lines.push(line);

            // Draw all lines, adjusting for multiple lines
            lines.forEach((l, i) => {
                // Adjust Y position upwards for multi-line text to center it around the Y coordinate
                const startY = y - ((lines.length - 1) * lineHeight / 2) + (i * lineHeight);
                ctx.fillText(l.trim(), x, startY);
            });
            
            // Clear shadow for next draw
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
        };

        processButton.addEventListener('click', () => {
            if (!isImageLoaded) return;

            // 1. Hide the HTML overlays during the capture process
            wishOverlay.style.opacity = '0';
            subOverlay.style.opacity = '0';

            // 2. Redraw the image background
            drawImageOnCanvas(); 
            
            // 3. Draw the custom text onto the Canvas
            applyCanvasText(wishOverlay, inputs.wishText.value, 20);
            applyCanvasText(subOverlay, inputs.subText.value, 15);

            // 4. Generate the final image data URL
            const finalImageDataURL = canvas.toDataURL('image/png');

            // 5. Update the output section
            finalImagePreview.src = finalImageDataURL;
            finalImagePreview.style.display = 'block';
            downloadLink.href = finalImageDataURL;
            outputArea.classList.remove('hidden');

            // 6. Restore the HTML overlays for continued editing
            setTimeout(() => {
                wishOverlay.style.opacity = '1';
                subOverlay.style.opacity = '1';
            }, 500);

            // Scroll to output
            finalImagePreview.scrollIntoView({ behavior: 'smooth' });
        });

        // --- Helper: Help Button Modal ---
        document.getElementById('helpButton').addEventListener('click', () => {
            const message = "## How to Use Wish Weaver\n\n1.  **Upload:** Click 'Choose Your Canvas' to select an image from your device.\n2.  **Customize:** Enter your 'Main Wish Statement' and the short 'Sub-Text' (max 20 words). Adjust their color, size, and font style.\n3.  **Position:** Drag the text boxes (the dashed white lines) directly on the preview image to place them anywhere you like.\n4.  **Generate:** Click 'Generate Shareable Card'. This creates the final, high-quality image.\n5.  **Share:** Download the PNG file and share it on WhatsApp, Instagram, or Facebook!\n\n**Tip:** The image is automatically cropped to fit the square preview frame perfectly (center crop).";
            
            // Simple custom modal/message box
            const existingModal = document.getElementById('infoModal');
            if (existingModal) existingModal.remove();

            const modal = document.createElement('div');
            modal.id = 'infoModal';
            modal.className = 'fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl p-6 max-w-lg w-full transform transition-all duration-300 scale-100">
                    <div class="flex justify-between items-center mb-4 border-b pb-2">
                        <h3 class="text-2xl font-bold text-primary-blue">Guide to Wish Weaver</h3>
                        <button id="closeModal" class="text-gray-500 hover:text-gray-800 transition">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </div>
                    <p class="text-gray-700 whitespace-pre-line">${message.replace(/## /g, '<h3>').replace(/\n/g, '<br>').replace(/<\/h3>/g, '</h3>')}</p>
                </div>
            `;
            document.body.appendChild(modal);
            document.getElementById('closeModal').addEventListener('click', () => modal.remove());
        });

    </script>
</body>
</html>
